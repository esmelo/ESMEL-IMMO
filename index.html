<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RH PRO+ | Analyseur Intelligent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f3f4f6; background-image: radial-gradient(#d1d5db 1px, transparent 1px); background-size: 40px 40px; }
        .text-gold { color: #D4AF37; }
        .bg-gold { background-color: #D4AF37; }
        .watermark { position: absolute; bottom: 10px; right: 10px; font-size: 5rem; font-weight: 900; color: rgba(0, 0, 0, 0.03); pointer-events: none; z-index: 0; }
        .star-rating i { cursor: pointer; transition: transform 0.2s; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <div class="max-w-5xl mx-auto p-4 md:p-10 flex-grow w-full">
        <div class="flex items-center justify-between mb-8 bg-white p-6 rounded-2xl shadow-sm border-l-8 border-blue-600 relative overflow-hidden">
            <div class="relative z-10">
                <h1 class="text-3xl font-black text-gray-800 tracking-tight italic">RH <span class="text-blue-600">PRO+</span></h1>
                <p class="text-gray-500 font-medium">Intelligence Artificielle au service du recrutement.</p>
            </div>
            <div class="hidden md:block relative z-10 text-right">
                <span class="bg-blue-50 text-blue-700 px-4 py-2 rounded-lg font-bold text-sm border border-blue-100 block mb-2">Version test</span>
                <div class="flex items-center justify-end text-[10px] font-black text-green-600 bg-green-50 px-3 py-1 rounded-full border border-green-200 animate-pulse">
                    <i class="fas fa-user-check mr-1"></i> Développé par Kouton Vignon
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
            <div class="lg:col-span-1">
                <form id="uploadForm" class="relative overflow-hidden space-y-6 bg-white p-6 rounded-2xl shadow-xl border border-gray-100 h-full">
                    <div class="watermark">PRO+</div>
                    <div>
                        <label class="block font-bold text-gray-700 mb-2 italic flex items-center"><i class="fas fa-pen-nib mr-2 text-blue-400"></i> Besoins du poste :</label>
                        <textarea name="job_description" id="job_desc" class="w-full border-2 border-gray-50 p-4 rounded-xl h-40 focus:border-blue-500 outline-none bg-gray-50/50 text-sm" required>{{ job_description }}</textarea>
                    </div>
                    <div>
                        <label class="block font-bold text-gray-700 mb-2 italic flex items-center"><i class="fas fa-file-import mr-2 text-blue-400"></i> Ajouter les CV :</label>
                        <div class="border-2 border-dashed border-gray-200 rounded-xl p-4 bg-gray-50 text-center hover:border-blue-400 transition-all relative">
                            <input type="file" accept=".pdf" multiple class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" id="cv-selector">
                            <i class="fas fa-plus-circle text-2xl text-blue-400 mb-2"></i>
                            <span class="block text-[10px] text-gray-400 font-bold uppercase">Cliquer pour ajouter un ou plusieurs PDF</span>
                        </div>
                        <div id="file-list" class="mt-4 space-y-2"></div>
                    </div>
                    <div>
                        <label class="block font-bold text-gray-700 mb-2 italic">Top Candidats :</label>
                        <input type="number" name="n_top" id="n_top" value="{{ n_top }}" class="w-full bg-gray-50 border-2 border-blue-50 p-2 rounded-xl text-center font-black text-blue-600">
                    </div>
                    <button type="submit" id="submitBtn" class="bg-slate-900 text-white py-4 rounded-xl w-full font-black shadow-lg hover:bg-blue-600 transition-all uppercase tracking-tighter flex items-center justify-center">
                        <span>Lancer le Scanning</span><i class="fas fa-bolt ml-2 text-yellow-400"></i>
                    </button>
                </form>
            </div>

            <div class="lg:col-span-2">
                {% if results is not none %}
                <div class="space-y-4">
                    <h2 class="text-2xl font-black text-gray-800 uppercase tracking-tight mb-6"><i class="fas fa-layer-group text-blue-600 mr-3"></i> Résultats</h2>
                    {% for res in results %}
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex items-center animate-fadeIn">
                        <div class="h-12 w-12 rounded-xl bg-slate-900 text-gold flex items-center justify-center font-black mr-5">{{ loop.index }}</div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-gray-800 truncate text-sm uppercase">{{ res.filename }}</h3>
                            <div class="w-full bg-gray-100 rounded-full h-1.5 mt-3"><div class="h-1.5 rounded-full bg-blue-600" style="width: {{ res.score }}%"></div></div>
                        </div>
                        <div class="text-right ml-4"><div class="text-3xl font-black text-slate-800">{{ res.score }}%</div></div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="h-full flex flex-col items-center justify-center border-4 border-dashed border-gray-200 rounded-3xl p-10 bg-white/40">
                    <i class="fas fa-microchip text-7xl text-gray-200 mb-6"></i>
                    <p class="font-black text-gray-400 uppercase text-xs tracking-widest">En attente de fichiers...</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="mt-16 max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
            <h3 class="text-center font-black text-gray-800 uppercase text-sm mb-6">Votre avis</h3>
            <div class="flex justify-center space-x-2 mb-6 star-rating text-2xl" id="starContainer">
                <i class="far fa-star text-gray-300" onclick="setRating(1)"></i><i class="far fa-star text-gray-300" onclick="setRating(2)"></i><i class="far fa-star text-gray-300" onclick="setRating(3)"></i><i class="far fa-star text-gray-300" onclick="setRating(4)"></i><i class="far fa-star text-gray-300" onclick="setRating(5)"></i>
            </div>
            <textarea id="userReview" placeholder="Commentaire..." class="w-full bg-gray-50 border border-gray-100 rounded-xl p-3 text-sm outline-none mb-4" rows="2"></textarea>
            <button onclick="submitReview()" class="w-full bg-gray-100 text-gray-600 font-bold py-2 rounded-lg hover:bg-blue-600 hover:text-white transition-all text-xs uppercase">Envoyer</button>
            <p id="thankYouMsg" class="hidden text-center text-green-500 font-bold text-[10px] mt-3 uppercase">Merci !</p>
        </div>

        <div class="mt-12 mb-10 grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="#" class="flex items-center justify-between bg-white border border-gray-100 p-4 rounded-2xl shadow-sm hover:border-orange-300 transition-all group">
                <div class="flex items-center space-x-4">
                    <div class="bg-orange-50 text-orange-500 p-3 rounded-xl group-hover:bg-orange-500 group-hover:text-white"><i class="fas fa-house-chimney"></i></div>
                    <div><p class="text-[10px] font-black text-gray-400 uppercase">Projet Immobilier</p><p class="font-bold text-gray-800 text-sm">Estimateur Intelligent</p></div>
                </div>
                <i class="fas fa-external-link-alt text-gray-300"></i>
            </a>
            <a href="https://www.linkedin.com/in/vignon-esmel-kouton-5113a1284" target="_blank" class="flex items-center justify-between bg-white border border-gray-100 p-4 rounded-2xl shadow-sm hover:border-blue-300 transition-all group">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-50 text-[#0077B5] p-3 rounded-xl group-hover:bg-[#0077B5] group-hover:text-white"><i class="fab fa-linkedin-in"></i></div>
                    <div><p class="text-[10px] font-black text-gray-400 uppercase">Kouton Vignon Esmel</p><p class="font-bold text-gray-800 text-sm">Sur LinkedIn</p></div>
                </div>
                <i class="fas fa-external-link-alt text-gray-300"></i>
            </a>
        </div>
        <p class="text-center text-[10px] font-black text-gray-400 uppercase tracking-[0.5em] mb-10">+225 0505411990</p>
    </div>

    <footer class="bg-slate-900 text-gold py-10 border-t-8 border-gold">
        <div class="max-w-5xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-8 items-center text-center">
            <div class="md:text-left"><p class="text-xs font-black uppercase mb-1 italic">RH PRO SYSTEM</p><p class="text-[9px] text-gray-500 font-bold uppercase">Créé et entrainer par Kouton Vignon</p></div>
            <div class="flex justify-center"><div class="h-10 w-10 border-2 border-gold rounded-full flex items-center justify-center"><i class="fas fa-crown animate-pulse"></i></div></div>
            <div class="md:text-right"><p class="text-[11px] font-black uppercase tracking-widest">Master 1 Data Science & IA</p><p class="text-[9px] text-gray-500 font-bold uppercase">Université Félix Houphouet-Boigny - Abidjan</p></div>
        </div>
    </footer>

    <script>
        let accumulatedFiles = [];
        const fileSelector = document.getElementById('cv-selector');
        const fileListContainer = document.getElementById('file-list');

        fileSelector.addEventListener('change', function(e) {
            // Ici, qu'on envoie 1 ou 10 fichiers d'un coup, ils sont ajoutés un par un à la liste
            Array.from(e.target.files).forEach(file => {
                if (!accumulatedFiles.some(f => f.name === file.name)) {
                    accumulatedFiles.push(file);
                    renderFileList();
                }
            });
            fileSelector.value = ""; // Réinitialise l'input pour pouvoir reprendre le même fichier si supprimé
        });

        function renderFileList() {
            fileListContainer.innerHTML = "";
            accumulatedFiles.forEach((file, index) => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between bg-blue-50 p-2 rounded-lg border border-blue-100 animate-fadeIn";
                div.innerHTML = `<div class="flex items-center"><i class="fas fa-file-pdf text-red-500 mr-2"></i><span class="text-[10px] font-bold text-blue-800 truncate max-w-[150px] uppercase">${file.name}</span></div><button type="button" onclick="removeFile(${index})" class="text-red-400 hover:text-red-600"><i class="fas fa-times-circle"></i></button>`;
                fileListContainer.appendChild(div);
            });
        }

        function removeFile(index) { accumulatedFiles.splice(index, 1); renderFileList(); }

        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            if (accumulatedFiles.length === 0) return alert("Ajoutez des CV !");
            const btn = document.getElementById('submitBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ANALYSE EN COURS...';
            const formData = new FormData();
            formData.append('job_description', document.getElementById('job_desc').value);
            formData.append('n_top', document.getElementById('n_top').value);
            accumulatedFiles.forEach(file => formData.append('files', file));
            const response = await fetch('/match', { method: 'POST', body: formData });
            if (response.ok) { document.documentElement.innerHTML = await response.text(); }
        });

        let currentRating = 0;
        function setRating(n) {
            currentRating = n;
            const stars = document.querySelectorAll('#starContainer i');
            stars.forEach((s, i) => { 
                s.className = i < n ? "fas fa-star text-yellow-400" : "far fa-star text-gray-300"; 
            });
        }

        async function submitReview() {
            if(currentRating === 0) return alert("Notez !");
            const data = { rating: currentRating, comment: document.getElementById('userReview').value };
            const res = await fetch('/feedback', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
            if(res.ok) { document.getElementById('thankYouMsg').classList.remove('hidden'); setTimeout(() => location.reload(), 2000); }
        }
    </script>
</body>
</html>